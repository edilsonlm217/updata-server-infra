version: '3.8'

services:
  elasticsearch:
    container_name: elasticsearch
    image: "docker.elastic.co/elasticsearch/elasticsearch:${ELASTIC_VERSION}"  # ğŸ”„ VersÃ£o dinÃ¢mica
    networks:
      - internal_network  # ğŸ•¸ï¸ ComunicaÃ§Ã£o privada entre serviÃ§os (ex: com Kibana)
    environment:
      - discovery.type=single-node  # ğŸ§ª Cluster nÃ³ Ãºnico
      - bootstrap.memory_lock=true  # ğŸš« Evita swap
      - xpack.security.enabled=true  # ğŸ” SeguranÃ§a ativada
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}  # ğŸ‘¤ Senha via variÃ¡vel
      - "ES_JAVA_OPTS=${ES_JAVA_OPTS}"  # ğŸ§  Heap da JVM
    ulimits:
      memlock:
        soft: -1
        hard: -1  # âœ… Travamento de memÃ³ria
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data  # ğŸ’¾ Dados persistentes
    restart: always  # ğŸ” ReinÃ­cio automÃ¡tico

  kibana:
    container_name: kibana
    image: "docker.elastic.co/kibana/kibana:${ELASTIC_VERSION}"  # Mesma versÃ£o do ES
    networks:
      - internal_network
    environment:
      - ELASTICSEARCH_HOSTS=${ELASTICSEARCH_HOSTS}
      - ELASTICSEARCH_USERNAME=${ELASTICSEARCH_USERNAME}  # UsuÃ¡rio via variÃ¡vel
      - ELASTICSEARCH_PASSWORD=${ELASTICSEARCH_PASSWORD}  # Senha via variÃ¡vel
    restart: always

volumes:
  elasticsearch_data:
    driver: local  # ğŸ“¦ Volume local para persistÃªncia

networks:
  internal_network:
    external: true  # ğŸŒ Rede jÃ¡ criada externamente
